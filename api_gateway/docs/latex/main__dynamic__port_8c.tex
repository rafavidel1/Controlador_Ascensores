\doxysection{src/main\+\_\+dynamic\+\_\+port.c File Reference}
\label{main__dynamic__port_8c}\index{src/main\_dynamic\_port.c@{src/main\_dynamic\_port.c}}


Versión del API Gateway que acepta puerto como parámetro.  


\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static char $\ast$ \textbf{ generate\+\_\+unique\+\_\+identity} ()
\item 
static char $\ast$ \textbf{ generate\+\_\+unique\+\_\+psk\+\_\+key} ()
\item 
static void \textbf{ simulate\+\_\+elevator\+\_\+group\+\_\+step} (coap\+\_\+context\+\_\+t $\ast$ctx, \textbf{ elevator\+\_\+group\+\_\+state\+\_\+t} $\ast$group)
\item 
void \textbf{ inicializar\+\_\+mi\+\_\+simulacion\+\_\+ascensor} (void)
\begin{DoxyCompactList}\small\item\em Inicializa el simulador de ascensores. \end{DoxyCompactList}\item 
void \textbf{ simular\+\_\+eventos\+\_\+ascensor} (void)
\begin{DoxyCompactList}\small\item\em Ejecuta una secuencia de eventos simulados de ascensor desde JSON. \end{DoxyCompactList}\item 
static int \textbf{ event\+\_\+handler\+\_\+gw} (coap\+\_\+session\+\_\+t $\ast$session, coap\+\_\+event\+\_\+t event)
\item 
coap\+\_\+session\+\_\+t $\ast$ \textbf{ get\+\_\+or\+\_\+create\+\_\+central\+\_\+server\+\_\+dtls\+\_\+session} (coap\+\_\+context\+\_\+t $\ast$ctx)
\begin{DoxyCompactList}\small\item\em Obtiene o crea una sesión DTLS con el servidor central. \end{DoxyCompactList}\item 
int \textbf{ main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile sig\+\_\+atomic\+\_\+t \textbf{ quit\+\_\+main\+\_\+loop} = 0
\begin{DoxyCompactList}\small\item\em Bandera para indicar si el bucle principal debe terminar. \end{DoxyCompactList}\item 
\textbf{ elevator\+\_\+group\+\_\+state\+\_\+t} \textbf{ managed\+\_\+elevator\+\_\+group}
\begin{DoxyCompactList}\small\item\em Estado del grupo de ascensores gestionado por este gateway. \end{DoxyCompactList}\item 
coap\+\_\+context\+\_\+t $\ast$ \textbf{ g\+\_\+coap\+\_\+context} = NULL
\begin{DoxyCompactList}\small\item\em Contexto Co\+AP global del API Gateway. \end{DoxyCompactList}\item 
coap\+\_\+session\+\_\+t $\ast$ \textbf{ g\+\_\+dtls\+\_\+session\+\_\+to\+\_\+central\+\_\+server} = NULL
\begin{DoxyCompactList}\small\item\em Sesión DTLS global con el servidor central. \end{DoxyCompactList}\item 
static coap\+\_\+context\+\_\+t $\ast$ \textbf{ g\+\_\+coap\+\_\+context\+\_\+for\+\_\+session\+\_\+mgnt} = NULL
\item 
static int \textbf{ dynamic\+\_\+listen\+\_\+port} = 5683
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Versión del API Gateway que acepta puerto como parámetro. 

Esta versión permite ejecutar múltiples instancias del API Gateway cada una escuchando en un puerto diferente para pruebas de carga.

Uso\+: ./api\+\_\+gateway\+\_\+dynamic [puerto\+\_\+escucha] Si no se especifica puerto, usa 5683 por defecto. 

\doxysubsection{Function Documentation}
\label{main__dynamic__port_8c_a4d72c24b61707ff5f39a4123ca8cd833} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!event\_handler\_gw@{event\_handler\_gw}}
\index{event\_handler\_gw@{event\_handler\_gw}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{event\_handler\_gw()}
{\footnotesize\ttfamily static int event\+\_\+handler\+\_\+gw (\begin{DoxyParamCaption}\item[{coap\+\_\+session\+\_\+t $\ast$}]{session,  }\item[{coap\+\_\+event\+\_\+t}]{event }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\label{main__dynamic__port_8c_aaab19c59907fdd4643b33b5056420f9b} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!generate\_unique\_identity@{generate\_unique\_identity}}
\index{generate\_unique\_identity@{generate\_unique\_identity}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{generate\_unique\_identity()}
{\footnotesize\ttfamily static char $\ast$ generate\+\_\+unique\+\_\+identity (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\label{main__dynamic__port_8c_a7deba370f74d01d89ecd93cb376b1873} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!generate\_unique\_psk\_key@{generate\_unique\_psk\_key}}
\index{generate\_unique\_psk\_key@{generate\_unique\_psk\_key}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{generate\_unique\_psk\_key()}
{\footnotesize\ttfamily static char $\ast$ generate\+\_\+unique\+\_\+psk\+\_\+key (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\label{main__dynamic__port_8c_a7910799dc4997ea7ff42bb0339134d94} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!get\_or\_create\_central\_server\_dtls\_session@{get\_or\_create\_central\_server\_dtls\_session}}
\index{get\_or\_create\_central\_server\_dtls\_session@{get\_or\_create\_central\_server\_dtls\_session}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{get\_or\_create\_central\_server\_dtls\_session()}
{\footnotesize\ttfamily coap\+\_\+session\+\_\+t $\ast$ get\+\_\+or\+\_\+create\+\_\+central\+\_\+server\+\_\+dtls\+\_\+session (\begin{DoxyParamCaption}\item[{coap\+\_\+context\+\_\+t $\ast$}]{ctx }\end{DoxyParamCaption})}



Obtiene o crea una sesión DTLS con el servidor central. 


\begin{DoxyParams}{Parameters}
{\em ctx} & Contexto Co\+AP a utilizar para la sesión \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Puntero a la sesión DTLS establecida, o NULL en caso de error
\end{DoxyReturn}
Esta función implementa un patrón singleton para la gestión de sesiones DTLS con el servidor central. Reutiliza sesiones existentes cuando están activas y crea nuevas sesiones cuando es necesario.

Comportamiento\+:
\begin{DoxyEnumerate}
\item Si existe una sesión activa y establecida, la reutiliza
\item Si la sesión existe pero no está establecida, la libera y crea una nueva
\item Si no existe sesión, crea una nueva con configuración DTLS-\/\+PSK
\item Registra el manejador de eventos para gestión automática de la sesión
\end{DoxyEnumerate}

La función utiliza las siguientes configuraciones\+:
\begin{DoxyItemize}
\item IP del servidor\+: CENTRAL\+\_\+\+SERVER\+\_\+\+IP
\item Puerto del servidor\+: CENTRAL\+\_\+\+SERVER\+\_\+\+PORT ~\newline

\item Identidad PSK\+: IDENTITY\+\_\+\+TO\+\_\+\+PRESENT\+\_\+\+TO\+\_\+\+SERVER
\item Clave PSK\+: KEY\+\_\+\+FOR\+\_\+\+SERVER
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxyref{event\+\_\+handler\+\_\+gw()}{p.}{main_8c_a4d72c24b61707ff5f39a4123ca8cd833} 

\doxyref{coap\+\_\+config.\+h}{p.}{coap__config_8h} 
\end{DoxySeeAlso}
\label{main__dynamic__port_8c_acfc4758bf8842f413c4d9e1c5ce6053d} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!inicializar\_mi\_simulacion\_ascensor@{inicializar\_mi\_simulacion\_ascensor}}
\index{inicializar\_mi\_simulacion\_ascensor@{inicializar\_mi\_simulacion\_ascensor}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{inicializar\_mi\_simulacion\_ascensor()}
{\footnotesize\ttfamily void inicializar\+\_\+mi\+\_\+simulacion\+\_\+ascensor (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Inicializa el simulador de ascensores. 

Esta función configura el simulador registrando el callback de respuesta CAN en el puente CAN-\/\+Co\+AP del API Gateway y cargando los datos de simulación desde el archivo JSON.

{\bfseries{Operaciones realizadas\+:}}
\begin{DoxyItemize}
\item Registro del callback de respuesta CAN
\item Carga de datos de simulación desde JSON
\item Inicialización de estructuras internas
\item Configuración de logging del simulador
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxyref{ag\+\_\+can\+\_\+bridge\+\_\+register\+\_\+send\+\_\+callback()}{p.}{can__bridge_8c_a82b3383904e65573e79b59f4b7c5ef15} 

\doxyref{cargar\+\_\+datos\+\_\+simulacion()}{p.}{group__simulation__functions_ga189a79642cdf0001b3a29062e4180af3} 

\doxyref{mi\+\_\+simulador\+\_\+recibe\+\_\+can\+\_\+gw()}{p.}{mi__simulador__ascensor_8c_adfcf33ff0806b77c246bbd870b029566} 
\end{DoxySeeAlso}
\label{main__dynamic__port_8c_a0ddf1224851353fc92bfbff6f499fa97} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!main@{main}}
\index{main@{main}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{main()}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv[$\,$] }\end{DoxyParamCaption})}

\label{main__dynamic__port_8c_a5c86f739de835826e9fa6dd607c52ec9} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!simular\_eventos\_ascensor@{simular\_eventos\_ascensor}}
\index{simular\_eventos\_ascensor@{simular\_eventos\_ascensor}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{simular\_eventos\_ascensor()}
{\footnotesize\ttfamily void simular\+\_\+eventos\+\_\+ascensor (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Ejecuta una secuencia de eventos simulados de ascensor desde JSON. 

Esta función reemplaza la simulación hardcodeada anterior. Ahora carga datos de simulación desde un archivo JSON, selecciona un edificio aleatorio y ejecuta todas sus peticiones secuencialmente.

{\bfseries{Proceso de simulación\+:}}
\begin{DoxyEnumerate}
\item Verifica si hay datos de simulación cargados
\item Selecciona un edificio aleatorio de los 100 disponibles
\item Configura el ID del edificio en el sistema
\item Ejecuta las 10 peticiones del edificio secuencialmente
\item Procesa I/O Co\+AP entre cada petición
\end{DoxyEnumerate}

{\bfseries{Fallback\+:}} Si no se pueden cargar los datos JSON, ejecuta la simulación básica de 2 peticiones hardcodeadas como antes.

{\bfseries{Características\+:}}
\begin{DoxyItemize}
\item Procesamiento de I/O Co\+AP entre eventos
\item Logging detallado de cada paso
\item Sincronización para evitar condiciones de carrera
\item Configuración automática del ID de edificio
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxyref{cargar\+\_\+datos\+\_\+simulacion()}{p.}{group__simulation__functions_ga189a79642cdf0001b3a29062e4180af3} 

\doxyref{seleccionar\+\_\+edificio\+\_\+aleatorio()}{p.}{group__simulation__functions_ga87620ad51d06f241a3106a36c40ac787} 

\doxyref{simular\+\_\+llamada\+\_\+de\+\_\+piso\+\_\+via\+\_\+can()}{p.}{mi__simulador__ascensor_8c_ad2f8184c447385d5155da6a8d87e6c16} 

\doxyref{simular\+\_\+solicitud\+\_\+cabina\+\_\+via\+\_\+can()}{p.}{mi__simulador__ascensor_8c_a75bd27a88662d9e2ac061e5285fc7ecb} 

coap\+\_\+io\+\_\+process() 
\end{DoxySeeAlso}
\label{main__dynamic__port_8c_af318206d98c90d1ed8b33a0f564ad219} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!simulate\_elevator\_group\_step@{simulate\_elevator\_group\_step}}
\index{simulate\_elevator\_group\_step@{simulate\_elevator\_group\_step}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{simulate\_elevator\_group\_step()}
{\footnotesize\ttfamily static void simulate\+\_\+elevator\+\_\+group\+\_\+step (\begin{DoxyParamCaption}\item[{coap\+\_\+context\+\_\+t $\ast$}]{ctx,  }\item[{\textbf{ elevator\+\_\+group\+\_\+state\+\_\+t} $\ast$}]{group }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



\doxysubsection{Variable Documentation}
\label{main__dynamic__port_8c_ab6cd46cca3fa91be58b4b7488c899731} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!dynamic\_listen\_port@{dynamic\_listen\_port}}
\index{dynamic\_listen\_port@{dynamic\_listen\_port}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{dynamic\_listen\_port}
{\footnotesize\ttfamily int dynamic\+\_\+listen\+\_\+port = 5683\hspace{0.3cm}{\ttfamily [static]}}

\label{main__dynamic__port_8c_abc8b9aeba00fbf6aeb7c811c034f383c} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!g\_coap\_context@{g\_coap\_context}}
\index{g\_coap\_context@{g\_coap\_context}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{g\_coap\_context}
{\footnotesize\ttfamily coap\+\_\+context\+\_\+t$\ast$ g\+\_\+coap\+\_\+context = NULL}



Contexto Co\+AP global del API Gateway. 

Referencia externa al contexto Co\+AP principal definido en \doxyref{main.\+c}{p.}{main_8c} del API Gateway. Utilizado para procesar eventos Co\+AP y enviar solicitudes al servidor central.

\begin{DoxySeeAlso}{See also}
api\+\_\+gateway/main.\+c
\end{DoxySeeAlso}
Contexto Co\+AP global del API Gateway.

Contexto principal utilizado para todas las operaciones Co\+AP, incluyendo la simulación de ascensores y la gestión de sesiones DTLS. \label{main__dynamic__port_8c_a003791cd6468260e13e2f2fd719e9fe4} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!g\_coap\_context\_for\_session\_mgnt@{g\_coap\_context\_for\_session\_mgnt}}
\index{g\_coap\_context\_for\_session\_mgnt@{g\_coap\_context\_for\_session\_mgnt}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{g\_coap\_context\_for\_session\_mgnt}
{\footnotesize\ttfamily coap\+\_\+context\+\_\+t$\ast$ g\+\_\+coap\+\_\+context\+\_\+for\+\_\+session\+\_\+mgnt = NULL\hspace{0.3cm}{\ttfamily [static]}}

\label{main__dynamic__port_8c_abe546e2cc7517fb0f6e0218ca1e3ff10} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!g\_dtls\_session\_to\_central\_server@{g\_dtls\_session\_to\_central\_server}}
\index{g\_dtls\_session\_to\_central\_server@{g\_dtls\_session\_to\_central\_server}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{g\_dtls\_session\_to\_central\_server}
{\footnotesize\ttfamily coap\+\_\+session\+\_\+t$\ast$ g\+\_\+dtls\+\_\+session\+\_\+to\+\_\+central\+\_\+server = NULL}



Sesión DTLS global con el servidor central. 

Declaración externa de la sesión DTLS definida en \doxyref{main.\+c}{p.}{main_8c}. Se utiliza para enviar solicitudes al servidor central de manera eficiente reutilizando la misma conexión segura.

\begin{DoxySeeAlso}{See also}
\doxyref{main.\+c}{p.}{main_8c} 

\doxyref{get\+\_\+or\+\_\+create\+\_\+central\+\_\+server\+\_\+dtls\+\_\+session()}{p.}{main_8c_a7910799dc4997ea7ff42bb0339134d94}
\end{DoxySeeAlso}
Mantiene la conexión segura DTLS-\/\+PSK con el servidor central para el envío de solicitudes de asignación de ascensores. Se reutiliza para múltiples solicitudes para eficiencia. \label{main__dynamic__port_8c_a2e69b946477ed035db425886fe261a13} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!managed\_elevator\_group@{managed\_elevator\_group}}
\index{managed\_elevator\_group@{managed\_elevator\_group}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{managed\_elevator\_group}
{\footnotesize\ttfamily \textbf{ elevator\+\_\+group\+\_\+state\+\_\+t} managed\+\_\+elevator\+\_\+group}



Estado del grupo de ascensores gestionado por este gateway. 

Estado global del grupo de ascensores gestionado por este gateway.

Grupo de ascensores gestionado.

Estado del grupo de ascensores gestionado.

Declaración externa para acceder al estado del grupo de ascensores gestionado en \doxyref{main.\+c}{p.}{main_8c}. Contiene información completa de todos los ascensores del edificio.

\begin{DoxySeeAlso}{See also}
\doxyref{elevator\+\_\+group\+\_\+state\+\_\+t}{p.}{structelevator__group__state__t} 

\doxyref{main.\+c}{p.}{main_8c}
\end{DoxySeeAlso}
Estado del grupo de ascensores gestionado por este gateway.

Contiene el estado completo de todos los ascensores del edificio gestionado por este API Gateway, incluyendo posiciones actuales, tareas asignadas, estados de puertas y disponibilidad.

\begin{DoxySeeAlso}{See also}
\doxyref{elevator\+\_\+group\+\_\+state\+\_\+t}{p.}{structelevator__group__state__t} 

\doxyref{elevator\+\_\+state\+\_\+manager.\+h}{p.}{elevator__state__manager_8h} 
\end{DoxySeeAlso}
\label{main__dynamic__port_8c_a8a485bed3bbf69f7556aa3167043d7e2} 
\index{main\_dynamic\_port.c@{main\_dynamic\_port.c}!quit\_main\_loop@{quit\_main\_loop}}
\index{quit\_main\_loop@{quit\_main\_loop}!main\_dynamic\_port.c@{main\_dynamic\_port.c}}
\doxysubsubsection{quit\_main\_loop}
{\footnotesize\ttfamily volatile sig\+\_\+atomic\+\_\+t quit\+\_\+main\+\_\+loop = 0}



Bandera para indicar si el bucle principal debe terminar. 

Bandera global para controlar el bucle principal de la aplicación.

Esta variable se declara como extern en api\+\_\+handlers.\+h y se define en \doxyref{main.\+c}{p.}{main_8c}. Es establecida por el manejador de señal (handle\+\_\+sigint\+\_\+gw) para detener el bucle principal de eventos.

\begin{DoxySeeAlso}{See also}
\doxyref{handle\+\_\+sigint\+\_\+gw()}{p.}{api__handlers_8c_a7fd01dcda5b603f45f20d97c84d9260b}
\end{DoxySeeAlso}
Bandera para indicar si el bucle principal debe terminar.

Esta bandera se establece a 1 por el manejador de señal SIGINT (handle\+\_\+sigint\+\_\+gw) para indicar que la aplicación debe terminar de manera elegante.

\begin{DoxySeeAlso}{See also}
\doxyref{handle\+\_\+sigint\+\_\+gw()}{p.}{api__handlers_8c_a7fd01dcda5b603f45f20d97c84d9260b} 
\end{DoxySeeAlso}
