\doxysection{src/mi\+\_\+simulador\+\_\+ascensor.c File Reference}
\hypertarget{mi__simulador__ascensor_8c}{}\label{mi__simulador__ascensor_8c}\index{src/mi\_simulador\_ascensor.c@{src/mi\_simulador\_ascensor.c}}


Simulador de Ascensores para Testing del API Gateway.  


{\ttfamily \#include "{}api\+\_\+gateway/can\+\_\+bridge.\+h"{}}\newline
{\ttfamily \#include "{}api\+\_\+gateway/elevator\+\_\+state\+\_\+manager.\+h"{}}\newline
{\ttfamily \#include "{}api\+\_\+gateway/simulation\+\_\+loader.\+h"{}}\newline
{\ttfamily \#include "{}api\+\_\+gateway/execution\+\_\+logger.\+h"{}}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$time.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
Include dependency graph for mi\+\_\+simulador\+\_\+ascensor.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{mi__simulador__ascensor_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{mi__simulador__ascensor_8c_adfcf33ff0806b77c246bbd870b029566}{mi\+\_\+simulador\+\_\+recibe\+\_\+can\+\_\+gw}} (simulated\+\_\+can\+\_\+frame\+\_\+t \texorpdfstring{$\ast$}{*}frame)
\begin{DoxyCompactList}\small\item\em Callback para recibir frames CAN de respuesta del gateway. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mi__simulador__ascensor_8c_acfc4758bf8842f413c4d9e1c5ce6053d}{inicializar\+\_\+mi\+\_\+simulacion\+\_\+ascensor}} (void)
\begin{DoxyCompactList}\small\item\em Inicializa el simulador de ascensores. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mi__simulador__ascensor_8c_ad2f8184c447385d5155da6a8d87e6c16}{simular\+\_\+llamada\+\_\+de\+\_\+piso\+\_\+via\+\_\+can}} (int piso\+\_\+origen, movement\+\_\+direction\+\_\+enum\+\_\+t direccion)
\begin{DoxyCompactList}\small\item\em Simula una llamada de piso vía CAN. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mi__simulador__ascensor_8c_a75bd27a88662d9e2ac061e5285fc7ecb}{simular\+\_\+solicitud\+\_\+cabina\+\_\+via\+\_\+can}} (int indice\+\_\+ascensor, int piso\+\_\+destino)
\begin{DoxyCompactList}\small\item\em Simula una solicitud de cabina vía CAN. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mi__simulador__ascensor_8c_a5c86f739de835826e9fa6dd607c52ec9}{simular\+\_\+eventos\+\_\+ascensor}} (void)
\begin{DoxyCompactList}\small\item\em Ejecuta una secuencia de eventos simulados de ascensor desde JSON de forma no-\/bloqueante. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{mi__simulador__ascensor_8c_a4a5671b859ec369365a41ed5e9d2084d}{procesar\+\_\+siguiente\+\_\+peticion\+\_\+simulacion}} (void)
\begin{DoxyCompactList}\small\item\em Procesa la siguiente petición de la simulación no-\/bloqueante. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
coap\+\_\+context\+\_\+t \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{mi__simulador__ascensor_8c_abc8b9aeba00fbf6aeb7c811c034f383c}{g\+\_\+coap\+\_\+context}}
\begin{DoxyCompactList}\small\item\em Contexto Co\+AP global del API Gateway. \end{DoxyCompactList}\item 
elevator\+\_\+group\+\_\+state\+\_\+t \mbox{\hyperlink{mi__simulador__ascensor_8c_a2e69b946477ed035db425886fe261a13}{managed\+\_\+elevator\+\_\+group}}
\begin{DoxyCompactList}\small\item\em Grupo de ascensores gestionado. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Simulador de Ascensores para Testing del API Gateway. 

\begin{DoxyAuthor}{Author}
Sistema de Control de Ascensores 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2025 
\end{DoxyDate}
\begin{DoxyVersion}{Version}
2.\+0
\end{DoxyVersion}
Este archivo implementa un simulador de ascensores que genera eventos CAN simulados para probar la funcionalidad del API Gateway. Sus funciones principales\+:


\begin{DoxyItemize}
\item {\bfseries{Simulación de eventos CAN}}\+: Generación de frames CAN simulados
\item {\bfseries{Callback de respuesta}}\+: Procesamiento de respuestas del gateway
\item {\bfseries{Integración con puente CAN}}\+: Interfaz con el sistema CAN-\/\+Co\+AP
\item {\bfseries{Testing automatizado}}\+: Secuencias de prueba predefinidas
\item {\bfseries{Carga desde JSON}}\+: Sistema de simulación basado en archivos de datos
\end{DoxyItemize}

{\bfseries{Tipos de eventos simulados\+:}}
\begin{DoxyItemize}
\item Llamadas de piso (floor calls) desde botones externos
\item Solicitudes de cabina (cabin requests) desde interior del ascensor
\item Notificaciones de llegada a destinos
\end{DoxyItemize}

El simulador utiliza el contexto Co\+AP global del API Gateway para procesar eventos y recibir respuestas del servidor central.

{\bfseries{Sistema de simulación JSON\+:}} Cada ejecución del API Gateway carga un archivo JSON con 100 edificios, selecciona uno aleatoriamente y ejecuta sus 10 peticiones secuencialmente.

\begin{DoxySeeAlso}{See also}
can\+\_\+bridge.\+h 

elevator\+\_\+state\+\_\+manager.\+h 

simulation\+\_\+loader.\+h 

api\+\_\+common\+\_\+defs.\+h 
\end{DoxySeeAlso}


\doxysubsection{Function Documentation}
\Hypertarget{mi__simulador__ascensor_8c_acfc4758bf8842f413c4d9e1c5ce6053d}\label{mi__simulador__ascensor_8c_acfc4758bf8842f413c4d9e1c5ce6053d} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!inicializar\_mi\_simulacion\_ascensor@{inicializar\_mi\_simulacion\_ascensor}}
\index{inicializar\_mi\_simulacion\_ascensor@{inicializar\_mi\_simulacion\_ascensor}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{inicializar\_mi\_simulacion\_ascensor()}{inicializar\_mi\_simulacion\_ascensor()}}
{\footnotesize\ttfamily void inicializar\+\_\+mi\+\_\+simulacion\+\_\+ascensor (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Inicializa el simulador de ascensores. 

Esta función configura el simulador registrando el callback de respuesta CAN en el puente CAN-\/\+Co\+AP del API Gateway y cargando los datos de simulación desde el archivo JSON.

{\bfseries{Operaciones realizadas\+:}}
\begin{DoxyItemize}
\item Registro del callback de respuesta CAN
\item Carga de datos de simulación desde JSON
\item Inicialización de estructuras internas
\item Configuración de logging del simulador
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxylink{can__bridge_8c_a82b3383904e65573e79b59f4b7c5ef15}{ag\+\_\+can\+\_\+bridge\+\_\+register\+\_\+send\+\_\+callback()} 

\doxylink{simulation__loader_8c_a189a79642cdf0001b3a29062e4180af3}{cargar\+\_\+datos\+\_\+simulacion()} 

\doxylink{mi__simulador__ascensor_8c_adfcf33ff0806b77c246bbd870b029566}{mi\+\_\+simulador\+\_\+recibe\+\_\+can\+\_\+gw()} 
\end{DoxySeeAlso}
\Hypertarget{mi__simulador__ascensor_8c_adfcf33ff0806b77c246bbd870b029566}\label{mi__simulador__ascensor_8c_adfcf33ff0806b77c246bbd870b029566} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!mi\_simulador\_recibe\_can\_gw@{mi\_simulador\_recibe\_can\_gw}}
\index{mi\_simulador\_recibe\_can\_gw@{mi\_simulador\_recibe\_can\_gw}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{mi\_simulador\_recibe\_can\_gw()}{mi\_simulador\_recibe\_can\_gw()}}
{\footnotesize\ttfamily void mi\+\_\+simulador\+\_\+recibe\+\_\+can\+\_\+gw (\begin{DoxyParamCaption}\item[{simulated\+\_\+can\+\_\+frame\+\_\+t \texorpdfstring{$\ast$}{*}}]{frame }\end{DoxyParamCaption})}



Callback para recibir frames CAN de respuesta del gateway. 


\begin{DoxyParams}{Parameters}
{\em frame} & Puntero al frame CAN simulado recibido del gateway\\
\hline
\end{DoxyParams}
Esta función actúa como callback registrado en el puente CAN para recibir y procesar las respuestas del API Gateway. Interpreta diferentes tipos de frames CAN de respuesta\+:

{\bfseries{Tipos de frames procesados\+:}}
\begin{DoxyItemize}
\item 0x101\+: Respuesta a llamada de piso (0x100)
\item 0x201\+: Respuesta a solicitud de cabina (0x200)
\item 0x\+FE\+: Error genérico del gateway
\end{DoxyItemize}

{\bfseries{Información extraída\+:}}
\begin{DoxyItemize}
\item Índice del ascensor asignado
\item ID de tarea (parcial, limitado por tamaño CAN)
\item Códigos de error y diagnóstico
\end{DoxyItemize}

La función proporciona logging detallado para debugging y verificación del comportamiento del sistema.

\begin{DoxySeeAlso}{See also}
\doxylink{can__bridge_8c_a82b3383904e65573e79b59f4b7c5ef15}{ag\+\_\+can\+\_\+bridge\+\_\+register\+\_\+send\+\_\+callback()} 

simulated\+\_\+can\+\_\+frame\+\_\+t 
\end{DoxySeeAlso}
\Hypertarget{mi__simulador__ascensor_8c_a4a5671b859ec369365a41ed5e9d2084d}\label{mi__simulador__ascensor_8c_a4a5671b859ec369365a41ed5e9d2084d} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!procesar\_siguiente\_peticion\_simulacion@{procesar\_siguiente\_peticion\_simulacion}}
\index{procesar\_siguiente\_peticion\_simulacion@{procesar\_siguiente\_peticion\_simulacion}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{procesar\_siguiente\_peticion\_simulacion()}{procesar\_siguiente\_peticion\_simulacion()}}
{\footnotesize\ttfamily bool procesar\+\_\+siguiente\+\_\+peticion\+\_\+simulacion (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Procesa la siguiente petición de la simulación no-\/bloqueante. 

Esta función debe llamarse desde el main loop para ejecutar las peticiones de forma incremental, permitiendo que el simulador de movimiento funcione en paralelo.

\begin{DoxyReturn}{Returns}
true si la simulación continúa, false si ha terminado 
\end{DoxyReturn}
\Hypertarget{mi__simulador__ascensor_8c_a5c86f739de835826e9fa6dd607c52ec9}\label{mi__simulador__ascensor_8c_a5c86f739de835826e9fa6dd607c52ec9} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!simular\_eventos\_ascensor@{simular\_eventos\_ascensor}}
\index{simular\_eventos\_ascensor@{simular\_eventos\_ascensor}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{simular\_eventos\_ascensor()}{simular\_eventos\_ascensor()}}
{\footnotesize\ttfamily void simular\+\_\+eventos\+\_\+ascensor (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Ejecuta una secuencia de eventos simulados de ascensor desde JSON de forma no-\/bloqueante. 

Esta función reemplaza la simulación bloqueante anterior. Ahora la simulación se ejecuta de forma incremental, permitiendo que el main loop procese I/O y ejecute la simulación de movimiento entre peticiones.

{\bfseries{Cambios principales\+:}}
\begin{DoxyItemize}
\item Simulación no-\/bloqueante (una petición por llamada)
\item Control regresa al main loop para permitir movimiento de ascensores
\item Intervalo configurable entre peticiones
\item Estado global para rastrear progreso
\end{DoxyItemize}

{\bfseries{Proceso de simulación\+:}}
\begin{DoxyEnumerate}
\item Inicialización\+: selecciona edificio y configura estado
\item Ejecución incremental\+: una petición por llamada
\item El main loop ejecuta tanto I/O como simulación de movimiento
\item Finalización automática al completar todas las peticiones
\end{DoxyEnumerate}

\begin{DoxyNote}{Note}
Esta función debe llamarse desde el main loop para ser no-\/bloqueante 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
simulate\+\_\+elevator\+\_\+group\+\_\+step() -\/ se ejecuta en paralelo 
\end{DoxySeeAlso}
\Hypertarget{mi__simulador__ascensor_8c_ad2f8184c447385d5155da6a8d87e6c16}\label{mi__simulador__ascensor_8c_ad2f8184c447385d5155da6a8d87e6c16} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!simular\_llamada\_de\_piso\_via\_can@{simular\_llamada\_de\_piso\_via\_can}}
\index{simular\_llamada\_de\_piso\_via\_can@{simular\_llamada\_de\_piso\_via\_can}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{simular\_llamada\_de\_piso\_via\_can()}{simular\_llamada\_de\_piso\_via\_can()}}
{\footnotesize\ttfamily void simular\+\_\+llamada\+\_\+de\+\_\+piso\+\_\+via\+\_\+can (\begin{DoxyParamCaption}\item[{int}]{piso\+\_\+origen,  }\item[{movement\+\_\+direction\+\_\+enum\+\_\+t}]{direccion }\end{DoxyParamCaption})}



Simula una llamada de piso vía CAN. 


\begin{DoxyParams}{Parameters}
{\em piso\+\_\+origen} & Piso desde el cual se realiza la llamada \\
\hline
{\em direccion} & Dirección solicitada (MOVING\+\_\+\+UP o MOVING\+\_\+\+DOWN)\\
\hline
\end{DoxyParams}
Esta función genera un frame CAN simulado que representa una llamada de piso desde un botón externo. El frame se envía al puente CAN-\/\+Co\+AP del API Gateway para su procesamiento.

{\bfseries{Formato del frame CAN\+:}}
\begin{DoxyItemize}
\item ID\+: 0x100 (identificador para llamadas de piso)
\item data\mbox{[}0\mbox{]}\+: Piso origen (0-\/255)
\item data\mbox{[}1\mbox{]}\+: Dirección (0=UP, 1=DOWN)
\item DLC\+: 2 bytes
\end{DoxyItemize}

{\bfseries{Validaciones\+:}}
\begin{DoxyItemize}
\item Verifica disponibilidad del contexto Co\+AP
\item Valida parámetros de entrada
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxylink{can__bridge_8c_aacea58e11d63ec4a2601d1b225af2af7}{ag\+\_\+can\+\_\+bridge\+\_\+process\+\_\+incoming\+\_\+frame()} 

movement\+\_\+direction\+\_\+enum\+\_\+t 
\end{DoxySeeAlso}
\Hypertarget{mi__simulador__ascensor_8c_a75bd27a88662d9e2ac061e5285fc7ecb}\label{mi__simulador__ascensor_8c_a75bd27a88662d9e2ac061e5285fc7ecb} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!simular\_solicitud\_cabina\_via\_can@{simular\_solicitud\_cabina\_via\_can}}
\index{simular\_solicitud\_cabina\_via\_can@{simular\_solicitud\_cabina\_via\_can}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{simular\_solicitud\_cabina\_via\_can()}{simular\_solicitud\_cabina\_via\_can()}}
{\footnotesize\ttfamily void simular\+\_\+solicitud\+\_\+cabina\+\_\+via\+\_\+can (\begin{DoxyParamCaption}\item[{int}]{indice\+\_\+ascensor,  }\item[{int}]{piso\+\_\+destino }\end{DoxyParamCaption})}



Simula una solicitud de cabina vía CAN. 


\begin{DoxyParams}{Parameters}
{\em indice\+\_\+ascensor} & Índice del ascensor que realiza la solicitud (0-\/based) \\
\hline
{\em piso\+\_\+destino} & Piso destino solicitado\\
\hline
\end{DoxyParams}
Esta función genera un frame CAN simulado que representa una solicitud de cabina desde el interior de un ascensor. El frame se envía al puente CAN-\/\+Co\+AP del API Gateway para su procesamiento.

{\bfseries{Formato del frame CAN\+:}}
\begin{DoxyItemize}
\item ID\+: 0x200 (identificador para solicitudes de cabina)
\item data\mbox{[}0\mbox{]}\+: Índice del ascensor (0-\/based, ej\+: 0 para E1\+A1)
\item data\mbox{[}1\mbox{]}\+: Piso destino (0-\/255)
\item DLC\+: 2 bytes
\end{DoxyItemize}

{\bfseries{Validaciones\+:}}
\begin{DoxyItemize}
\item Verifica disponibilidad del contexto Co\+AP
\item Valida parámetros de entrada
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El índice del ascensor se mapea a IDs como E1\+A1, E1\+A2, etc.
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{can__bridge_8c_aacea58e11d63ec4a2601d1b225af2af7}{ag\+\_\+can\+\_\+bridge\+\_\+process\+\_\+incoming\+\_\+frame()} 

simulated\+\_\+can\+\_\+frame\+\_\+t 
\end{DoxySeeAlso}


\doxysubsection{Variable Documentation}
\Hypertarget{mi__simulador__ascensor_8c_abc8b9aeba00fbf6aeb7c811c034f383c}\label{mi__simulador__ascensor_8c_abc8b9aeba00fbf6aeb7c811c034f383c} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!g\_coap\_context@{g\_coap\_context}}
\index{g\_coap\_context@{g\_coap\_context}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{g\_coap\_context}{g\_coap\_context}}
{\footnotesize\ttfamily coap\+\_\+context\+\_\+t\texorpdfstring{$\ast$}{*} g\+\_\+coap\+\_\+context\hspace{0.3cm}{\ttfamily [extern]}}



Contexto Co\+AP global del API Gateway. 

Referencia externa al contexto Co\+AP principal definido en \doxylink{main_8c}{main.\+c} del API Gateway. Utilizado para procesar eventos Co\+AP y enviar solicitudes al servidor central.

\begin{DoxySeeAlso}{See also}
api\+\_\+gateway/main.\+c
\end{DoxySeeAlso}
Contexto Co\+AP global del API Gateway.

Contexto principal utilizado para todas las operaciones Co\+AP, incluyendo la simulación de ascensores y la gestión de sesiones DTLS. \Hypertarget{mi__simulador__ascensor_8c_a2e69b946477ed035db425886fe261a13}\label{mi__simulador__ascensor_8c_a2e69b946477ed035db425886fe261a13} 
\index{mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}!managed\_elevator\_group@{managed\_elevator\_group}}
\index{managed\_elevator\_group@{managed\_elevator\_group}!mi\_simulador\_ascensor.c@{mi\_simulador\_ascensor.c}}
\doxysubsubsection{\texorpdfstring{managed\_elevator\_group}{managed\_elevator\_group}}
{\footnotesize\ttfamily elevator\+\_\+group\+\_\+state\+\_\+t managed\+\_\+elevator\+\_\+group\hspace{0.3cm}{\ttfamily [extern]}}



Grupo de ascensores gestionado. 

Referencia externa al grupo de ascensores principal definido en \doxylink{main_8c}{main.\+c}. Se utiliza para configurar el ID del edificio durante la simulación.

\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t
\end{DoxySeeAlso}
Grupo de ascensores gestionado.

Estado del grupo de ascensores gestionado.

Estado del grupo de ascensores gestionado por este gateway.

Contiene el estado completo de todos los ascensores del edificio gestionado por este API Gateway, incluyendo posiciones actuales, tareas asignadas, estados de puertas y disponibilidad.

\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t 

elevator\+\_\+state\+\_\+manager.\+h
\end{DoxySeeAlso}
Grupo de ascensores gestionado.

Estado del grupo de ascensores gestionado.

Declaración externa para acceder al estado del grupo de ascensores gestionado en \doxylink{main_8c}{main.\+c}. Contiene información completa de todos los ascensores del edificio.

\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t 

\doxylink{main_8c}{main.\+c}
\end{DoxySeeAlso}
Estado del grupo de ascensores gestionado por este gateway.

Contiene el estado completo de todos los ascensores del edificio gestionado por este API Gateway, incluyendo posiciones actuales, tareas asignadas, estados de puertas y disponibilidad.

\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t 

elevator\+\_\+state\+\_\+manager.\+h 
\end{DoxySeeAlso}
