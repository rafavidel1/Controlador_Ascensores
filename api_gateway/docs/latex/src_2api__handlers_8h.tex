\doxysection{src/api\+\_\+handlers.h File Reference}
\label{src_2api__handlers_8h}\index{src/api\_handlers.h@{src/api\_handlers.h}}


Declares Co\+AP handler functions and related data structures for the API Gateway.  


\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \textbf{ api\+\_\+request\+\_\+tracker\+\_\+t}
\begin{DoxyCompactList}\small\item\em Tracks information from an original client (elevator) request OR a gateway-\/originated request. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \textbf{ gw\+\_\+request\+\_\+type\+\_\+t} \{ \textbf{ GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+UNKNOWN}
, \textbf{ GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+FLOOR\+\_\+\+CALL}
, \textbf{ GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+CABIN\+\_\+\+REQUEST}
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ handle\+\_\+sigint\+\_\+gw} (int signum)
\begin{DoxyCompactList}\small\item\em Signal handler for SIGINT (Ctrl+C) to allow graceful shutdown. \end{DoxyCompactList}\item 
coap\+\_\+response\+\_\+t \textbf{ hnd\+\_\+central\+\_\+server\+\_\+response\+\_\+gw} (coap\+\_\+session\+\_\+t $\ast$session\+\_\+to\+\_\+central, const coap\+\_\+pdu\+\_\+t $\ast$sent\+\_\+to\+\_\+central, const coap\+\_\+pdu\+\_\+t $\ast$received\+\_\+from\+\_\+central, const coap\+\_\+mid\+\_\+t mid\+\_\+to\+\_\+central)
\begin{DoxyCompactList}\small\item\em Handles responses received from the Central Server. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Declares Co\+AP handler functions and related data structures for the API Gateway. 

This file provides the interface for the Co\+AP NACK/response handler for client requests made by the gateway. 

\doxysubsection{Enumeration Type Documentation}
\label{src_2api__handlers_8h_a17e4539046553af2ffabda67ff75cbb0} 
\index{api\_handlers.h@{api\_handlers.h}!gw\_request\_type\_t@{gw\_request\_type\_t}}
\index{gw\_request\_type\_t@{gw\_request\_type\_t}!api\_handlers.h@{api\_handlers.h}}
\doxysubsubsection{gw\_request\_type\_t}
{\footnotesize\ttfamily enum \textbf{ gw\+\_\+request\+\_\+type\+\_\+t}}

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{GW\_REQUEST\_TYPE\_UNKNOWN@{GW\_REQUEST\_TYPE\_UNKNOWN}!api\_handlers.h@{api\_handlers.h}}\index{api\_handlers.h@{api\_handlers.h}!GW\_REQUEST\_TYPE\_UNKNOWN@{GW\_REQUEST\_TYPE\_UNKNOWN}}}\label{src_2api__handlers_8h_a17e4539046553af2ffabda67ff75cbb0ae0f69383a1f168c37cc7f8fc70e1f42e} 
GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+UNKNOWN&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{GW\_REQUEST\_TYPE\_FLOOR\_CALL@{GW\_REQUEST\_TYPE\_FLOOR\_CALL}!api\_handlers.h@{api\_handlers.h}}\index{api\_handlers.h@{api\_handlers.h}!GW\_REQUEST\_TYPE\_FLOOR\_CALL@{GW\_REQUEST\_TYPE\_FLOOR\_CALL}}}\label{src_2api__handlers_8h_a17e4539046553af2ffabda67ff75cbb0aad2430297848cdfb0e5be7eda7c01300} 
GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+FLOOR\+\_\+\+CALL&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{GW\_REQUEST\_TYPE\_CABIN\_REQUEST@{GW\_REQUEST\_TYPE\_CABIN\_REQUEST}!api\_handlers.h@{api\_handlers.h}}\index{api\_handlers.h@{api\_handlers.h}!GW\_REQUEST\_TYPE\_CABIN\_REQUEST@{GW\_REQUEST\_TYPE\_CABIN\_REQUEST}}}\label{src_2api__handlers_8h_a17e4539046553af2ffabda67ff75cbb0ac516ba6346d0cc1d0ed36ad6b24000af} 
GW\+\_\+\+REQUEST\+\_\+\+TYPE\+\_\+\+CABIN\+\_\+\+REQUEST&\\
\hline

\end{DoxyEnumFields}


\doxysubsection{Function Documentation}
\label{src_2api__handlers_8h_a7fd01dcda5b603f45f20d97c84d9260b} 
\index{api\_handlers.h@{api\_handlers.h}!handle\_sigint\_gw@{handle\_sigint\_gw}}
\index{handle\_sigint\_gw@{handle\_sigint\_gw}!api\_handlers.h@{api\_handlers.h}}
\doxysubsubsection{handle\_sigint\_gw()}
{\footnotesize\ttfamily void handle\+\_\+sigint\+\_\+gw (\begin{DoxyParamCaption}\item[{int}]{signum }\end{DoxyParamCaption})}



Signal handler for SIGINT (Ctrl+C) to allow graceful shutdown. 


\begin{DoxyParams}{Parameters}
{\em signum} & The signal number (unused).\\
\hline
\end{DoxyParams}
Signal handler for SIGINT (Ctrl+C) to allow graceful shutdown.


\begin{DoxyParams}{Parameters}
{\em signum} & Número de señal recibida (se espera SIGINT). No utilizado.\\
\hline
\end{DoxyParams}
Establece la bandera quit\+\_\+main\+\_\+loop a 1 para señalar al bucle principal de eventos que debe terminar, permitiendo una terminación elegante del API Gateway.

Esta función es registrada como manejador de SIGINT en \doxyref{main.\+c}{p.}{main_8c} y proporciona una forma limpia de cerrar la aplicación. \label{src_2api__handlers_8h_aba27754223447346d8049fc61efcd6f8} 
\index{api\_handlers.h@{api\_handlers.h}!hnd\_central\_server\_response\_gw@{hnd\_central\_server\_response\_gw}}
\index{hnd\_central\_server\_response\_gw@{hnd\_central\_server\_response\_gw}!api\_handlers.h@{api\_handlers.h}}
\doxysubsubsection{hnd\_central\_server\_response\_gw()}
{\footnotesize\ttfamily coap\+\_\+response\+\_\+t hnd\+\_\+central\+\_\+server\+\_\+response\+\_\+gw (\begin{DoxyParamCaption}\item[{coap\+\_\+session\+\_\+t $\ast$}]{session\+\_\+from\+\_\+server,  }\item[{const coap\+\_\+pdu\+\_\+t $\ast$}]{sent\+\_\+to\+\_\+central,  }\item[{const coap\+\_\+pdu\+\_\+t $\ast$}]{received\+\_\+from\+\_\+central,  }\item[{const coap\+\_\+mid\+\_\+t}]{mid\+\_\+from\+\_\+server }\end{DoxyParamCaption})}



Handles responses received from the Central Server. 

This function is registered as a Co\+AP NACK/response handler for requests made by the API Gateway (acting as a client) to the Central Server. It processes the Central Server\textquotesingle{}s response and forwards it to the original elevator client (if applicable) or updates internal state (e.\+g. for CAN originated).


\begin{DoxyParams}{Parameters}
{\em session\+\_\+to\+\_\+central} & The Co\+AP session between the API Gateway and the Central Server. \\
\hline
{\em sent\+\_\+to\+\_\+central} & The PDU that the API Gateway sent to the Central Server (can be NULL). \\
\hline
{\em received\+\_\+from\+\_\+central} & The PDU received from the Central Server. \\
\hline
{\em mid\+\_\+to\+\_\+central} & The Co\+AP Message ID of the exchange with the Central Server. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
COAP\+\_\+\+RESPONSE\+\_\+\+OK to indicate the response was handled.
\end{DoxyReturn}
Handles responses received from the Central Server.


\begin{DoxyParams}{Parameters}
{\em session\+\_\+from\+\_\+server} & Sesión Co\+AP desde la cual se recibió la respuesta \\
\hline
{\em sent\+\_\+to\+\_\+central} & PDU que fue enviado al servidor central \\
\hline
{\em received\+\_\+from\+\_\+central} & PDU recibido del servidor central \\
\hline
{\em mid\+\_\+from\+\_\+server} & Message ID de la respuesta del servidor \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
COAP\+\_\+\+RESPONSE\+\_\+\+OK si la respuesta se procesó correctamente
\end{DoxyReturn}
Esta función procesa las respuestas recibidas del servidor central para solicitudes de asignación de ascensores. Realiza las siguientes operaciones\+:


\begin{DoxyEnumerate}
\item {\bfseries{Validación}}\+: Verifica que se recibió un PDU válido
\item {\bfseries{Parsing JSON}}\+: Extrae y parsea el payload JSON de la respuesta
\item {\bfseries{Correlación}}\+: Encuentra el tracker original usando el token
\item {\bfseries{Procesamiento}}\+: Extrae información de asignación (ascensor\+\_\+asignado\+\_\+id, tarea\+\_\+id)
\item {\bfseries{Notificación CAN}}\+: Envía respuesta al controlador CAN correspondiente
\item {\bfseries{Limpieza}}\+: Libera recursos del tracker y memoria asociada
\end{DoxyEnumerate}

Maneja diferentes códigos de respuesta\+:
\begin{DoxyItemize}
\item 2.\+01 Created\+: Asignación exitosa
\item 4.\+xx Client Error\+: Errores de solicitud
\item 5.\+xx Server Error\+: Errores del servidor
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\doxyref{add\+\_\+central\+\_\+request\+\_\+tracker()}{p.}{api__handlers_8c_a7292f2cbff08db77c70629ddbac256dc} 

\doxyref{find\+\_\+and\+\_\+remove\+\_\+central\+\_\+request\+\_\+tracker()}{p.}{api__handlers_8c_a5f19bc5f95b0869d7b25b596f6767877} 

\doxyref{can\+\_\+bridge.\+h}{p.}{can__bridge_8h} 
\end{DoxySeeAlso}
