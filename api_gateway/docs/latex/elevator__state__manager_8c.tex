\doxysection{src/elevator\+\_\+state\+\_\+manager.c File Reference}
\hypertarget{elevator__state__manager_8c}{}\label{elevator__state__manager_8c}\index{src/elevator\_state\_manager.c@{src/elevator\_state\_manager.c}}


Implementación del Gestor de Estado de Ascensores del API Gateway.  


{\ttfamily \#include "{}api\+\_\+gateway/elevator\+\_\+state\+\_\+manager.\+h"{}}\newline
{\ttfamily \#include "{}api\+\_\+gateway/execution\+\_\+logger.\+h"{}}\newline
{\ttfamily \#include "{}api\+\_\+gateway/logging\+\_\+gw.\+h"{}}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
Include dependency graph for elevator\+\_\+state\+\_\+manager.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{elevator__state__manager_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{elevator__state__manager_8c_aa035ebf813e4df0e747c251865f217db}{door\+\_\+state\+\_\+to\+\_\+string}} (door\+\_\+state\+\_\+enum\+\_\+t state)
\begin{DoxyCompactList}\small\item\em Convierte un estado de puerta a su representación en string. \end{DoxyCompactList}\item 
const char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{elevator__state__manager_8c_a9f8c127c735277e87e71a52ba68d2e56}{movement\+\_\+direction\+\_\+to\+\_\+string}} (movement\+\_\+direction\+\_\+enum\+\_\+t direction)
\begin{DoxyCompactList}\small\item\em Convierte una dirección de movimiento a su representación en string. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{elevator__state__manager_8c_ad1f96394c1b8256e78409c71a912eea1}{init\+\_\+elevator\+\_\+group}} (elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}group, const char \texorpdfstring{$\ast$}{*}edificio\+\_\+id\+\_\+str, int num\+\_\+elevadores, int num\+\_\+pisos)
\begin{DoxyCompactList}\small\item\em Inicializa un grupo de ascensores con configuración específica. \end{DoxyCompactList}\item 
c\+JSON \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{elevator__state__manager_8c_ab9cb3524ec8747ce92dc01657dbb7a5a}{elevator\+\_\+group\+\_\+to\+\_\+json\+\_\+for\+\_\+server}} (const elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}group, gw\+\_\+request\+\_\+type\+\_\+t request\+\_\+type, const api\+\_\+request\+\_\+details\+\_\+for\+\_\+json\+\_\+t \texorpdfstring{$\ast$}{*}details)
\begin{DoxyCompactList}\small\item\em Serializa el estado del grupo de ascensores a JSON para el servidor central. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{elevator__state__manager_8c_a7a4e6bf1bb74d59a17c1d77689d93ccc}{assign\+\_\+task\+\_\+to\+\_\+elevator}} (elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}group, const char \texorpdfstring{$\ast$}{*}elevator\+\_\+id\+\_\+to\+\_\+update, const char \texorpdfstring{$\ast$}{*}task\+\_\+id, int target\+\_\+floor, int current\+\_\+request\+\_\+floor)
\begin{DoxyCompactList}\small\item\em Actualiza el estado de un ascensor tras recibir asignación de tarea. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementación del Gestor de Estado de Ascensores del API Gateway. 

\begin{DoxyAuthor}{Author}
Sistema de Control de Ascensores 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2025 
\end{DoxyDate}
\begin{DoxyVersion}{Version}
2.\+0
\end{DoxyVersion}
Este archivo implementa la gestión completa del estado de ascensores en el API Gateway, proporcionando funcionalidades para\+:


\begin{DoxyItemize}
\item {\bfseries{Inicialización de grupos}}\+: Configuración inicial de grupos de ascensores
\item {\bfseries{Gestión de estado}}\+: Mantenimiento del estado actual de cada ascensor
\item {\bfseries{Asignación de tareas}}\+: Asignación de tareas a ascensores específicos
\item {\bfseries{Notificaciones de llegada}}\+: Procesamiento de llegadas a destinos
\item {\bfseries{Serialización JSON}}\+: Conversión del estado a formato JSON para servidor central
\item {\bfseries{Utilidades de conversión}}\+: Funciones helper para strings de estado
\end{DoxyItemize}

El gestor mantiene información completa de cada ascensor incluyendo\+:
\begin{DoxyItemize}
\item Posición actual (piso)
\item Estado de puertas (abierta/cerrada/abriendo/cerrando)
\item Dirección de movimiento (subiendo/bajando/parado)
\item Tarea actual asignada
\item Destino actual
\item Estado de ocupación
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
elevator\+\_\+state\+\_\+manager.\+h 

api\+\_\+common\+\_\+defs.\+h 

\doxylink{api__handlers_8h}{api\+\_\+handlers.\+h} 
\end{DoxySeeAlso}


\doxysubsection{Function Documentation}
\Hypertarget{elevator__state__manager_8c_a7a4e6bf1bb74d59a17c1d77689d93ccc}\label{elevator__state__manager_8c_a7a4e6bf1bb74d59a17c1d77689d93ccc} 
\index{elevator\_state\_manager.c@{elevator\_state\_manager.c}!assign\_task\_to\_elevator@{assign\_task\_to\_elevator}}
\index{assign\_task\_to\_elevator@{assign\_task\_to\_elevator}!elevator\_state\_manager.c@{elevator\_state\_manager.c}}
\doxysubsubsection{\texorpdfstring{assign\_task\_to\_elevator()}{assign\_task\_to\_elevator()}}
{\footnotesize\ttfamily void assign\+\_\+task\+\_\+to\+\_\+elevator (\begin{DoxyParamCaption}\item[{elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}}]{group,  }\item[{const char \texorpdfstring{$\ast$}{*}}]{elevator\+\_\+id\+\_\+to\+\_\+update,  }\item[{const char \texorpdfstring{$\ast$}{*}}]{task\+\_\+id,  }\item[{int}]{target\+\_\+floor,  }\item[{int}]{current\+\_\+request\+\_\+floor }\end{DoxyParamCaption})}



Actualiza el estado de un ascensor tras recibir asignación de tarea. 


\begin{DoxyParams}{Parameters}
{\em group} & Puntero al grupo de ascensores \\
\hline
{\em elevator\+\_\+id\+\_\+to\+\_\+update} & ID del ascensor a actualizar \\
\hline
{\em task\+\_\+id} & El nuevo ID de tarea asignado \\
\hline
{\em target\+\_\+floor} & El piso destino para esta tarea \\
\hline
{\em current\+\_\+request\+\_\+floor} & El piso donde se originó la solicitud\\
\hline
\end{DoxyParams}
Esta función actualiza el estado de un ascensor específico después de recibir una asignación de tarea del servidor central. Realiza\+:

{\bfseries{Operaciones realizadas\+:}}
\begin{DoxyItemize}
\item Busca el ascensor por ID en el grupo
\item Asigna la nueva tarea y piso destino
\item Marca el ascensor como ocupado
\item Determina y actualiza la dirección de movimiento
\item Registra la asignación en el sistema de logging
\end{DoxyItemize}

La dirección de movimiento se calcula comparando el piso actual del ascensor con el piso destino de la tarea.

\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t 

elevator\+\_\+status\+\_\+t 

\doxylink{execution__logger_8c_ac545eb869f25dc8a259c8cc8d79012be}{exec\+\_\+logger\+\_\+log\+\_\+task\+\_\+assigned()} 
\end{DoxySeeAlso}
\Hypertarget{elevator__state__manager_8c_aa035ebf813e4df0e747c251865f217db}\label{elevator__state__manager_8c_aa035ebf813e4df0e747c251865f217db} 
\index{elevator\_state\_manager.c@{elevator\_state\_manager.c}!door\_state\_to\_string@{door\_state\_to\_string}}
\index{door\_state\_to\_string@{door\_state\_to\_string}!elevator\_state\_manager.c@{elevator\_state\_manager.c}}
\doxysubsubsection{\texorpdfstring{door\_state\_to\_string()}{door\_state\_to\_string()}}
{\footnotesize\ttfamily const char \texorpdfstring{$\ast$}{*} door\+\_\+state\+\_\+to\+\_\+string (\begin{DoxyParamCaption}\item[{door\+\_\+state\+\_\+enum\+\_\+t}]{state }\end{DoxyParamCaption})}



Convierte un estado de puerta a su representación en string. 


\begin{DoxyParams}{Parameters}
{\em state} & Estado de puerta a convertir \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
String representando el estado de la puerta
\end{DoxyReturn}
Esta función proporciona una representación legible del estado de las puertas del ascensor para logging y serialización JSON.

Estados soportados\+:
\begin{DoxyItemize}
\item DOOR\+\_\+\+CLOSED\+: "{}\+CERRADA"{}
\item DOOR\+\_\+\+OPEN\+: "{}\+ABIERTA"{} ~\newline

\item DOOR\+\_\+\+OPENING\+: "{}\+ABRIENDO"{}
\item DOOR\+\_\+\+CLOSING\+: "{}\+CERRANDO"{}
\item Otros\+: "{}\+DESCONOCIDO"{} 
\end{DoxyItemize}\Hypertarget{elevator__state__manager_8c_ab9cb3524ec8747ce92dc01657dbb7a5a}\label{elevator__state__manager_8c_ab9cb3524ec8747ce92dc01657dbb7a5a} 
\index{elevator\_state\_manager.c@{elevator\_state\_manager.c}!elevator\_group\_to\_json\_for\_server@{elevator\_group\_to\_json\_for\_server}}
\index{elevator\_group\_to\_json\_for\_server@{elevator\_group\_to\_json\_for\_server}!elevator\_state\_manager.c@{elevator\_state\_manager.c}}
\doxysubsubsection{\texorpdfstring{elevator\_group\_to\_json\_for\_server()}{elevator\_group\_to\_json\_for\_server()}}
{\footnotesize\ttfamily c\+JSON \texorpdfstring{$\ast$}{*} elevator\+\_\+group\+\_\+to\+\_\+json\+\_\+for\+\_\+server (\begin{DoxyParamCaption}\item[{const elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}}]{group,  }\item[{gw\+\_\+request\+\_\+type\+\_\+t}]{request\+\_\+type,  }\item[{const api\+\_\+request\+\_\+details\+\_\+for\+\_\+json\+\_\+t \texorpdfstring{$\ast$}{*}}]{details }\end{DoxyParamCaption})}



Serializa el estado del grupo de ascensores a JSON para el servidor central. 


\begin{DoxyParams}{Parameters}
{\em group} & Puntero al estado del grupo de ascensores \\
\hline
{\em request\+\_\+type} & El tipo de la solicitud original que motiva este payload \\
\hline
{\em details} & Puntero a estructura con detalles específicos de la solicitud (puede ser NULL) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Puntero a objeto c\+JSON que representa el payload, o NULL en caso de error
\end{DoxyReturn}
Esta función convierte el estado completo del grupo de ascensores y los detalles de la solicitud específica a un objeto JSON formateado como espera el servidor central para procesamiento de asignaciones.

{\bfseries{JSON generado incluye\+:}}
\begin{DoxyItemize}
\item ID del edificio
\item Detalles específicos de la solicitud (piso origen, destino, etc.)
\item Array con estado de todos los ascensores del grupo
\item Para cada ascensor\+: ID, piso actual, estado puertas, disponibilidad
\end{DoxyItemize}

El llamador es responsable de liberar el objeto c\+JSON con c\+JSON\+\_\+\+Delete().

\begin{DoxySeeAlso}{See also}
gw\+\_\+request\+\_\+type\+\_\+t 

api\+\_\+request\+\_\+details\+\_\+for\+\_\+json\+\_\+t 

elevator\+\_\+group\+\_\+state\+\_\+t 
\end{DoxySeeAlso}
\Hypertarget{elevator__state__manager_8c_ad1f96394c1b8256e78409c71a912eea1}\label{elevator__state__manager_8c_ad1f96394c1b8256e78409c71a912eea1} 
\index{elevator\_state\_manager.c@{elevator\_state\_manager.c}!init\_elevator\_group@{init\_elevator\_group}}
\index{init\_elevator\_group@{init\_elevator\_group}!elevator\_state\_manager.c@{elevator\_state\_manager.c}}
\doxysubsubsection{\texorpdfstring{init\_elevator\_group()}{init\_elevator\_group()}}
{\footnotesize\ttfamily void init\+\_\+elevator\+\_\+group (\begin{DoxyParamCaption}\item[{elevator\+\_\+group\+\_\+state\+\_\+t \texorpdfstring{$\ast$}{*}}]{group,  }\item[{const char \texorpdfstring{$\ast$}{*}}]{edificio\+\_\+id\+\_\+str,  }\item[{int}]{num\+\_\+elevadores,  }\item[{int}]{num\+\_\+pisos }\end{DoxyParamCaption})}



Inicializa un grupo de ascensores con configuración específica. 


\begin{DoxyParams}{Parameters}
{\em group} & Puntero al grupo de ascensores a inicializar \\
\hline
{\em edificio\+\_\+id\+\_\+str} & ID del edificio al que pertenece el grupo \\
\hline
{\em num\+\_\+elevadores} & Número de ascensores en el grupo \\
\hline
{\em num\+\_\+pisos} & Número de pisos del edificio\\
\hline
\end{DoxyParams}
Esta función inicializa completamente un grupo de ascensores con la configuración especificada. Realiza las siguientes operaciones\+:


\begin{DoxyEnumerate}
\item {\bfseries{Validación}}\+: Verifica parámetros de entrada válidos
\item {\bfseries{Limpieza}}\+: Inicializa la estructura a cero
\item {\bfseries{Configuración del grupo}}\+: Establece ID del edificio y número de ascensores
\item {\bfseries{Inicialización individual}}\+: Configura cada ascensor con\+:
\begin{DoxyItemize}
\item ID único (formato\+: \{edificio\+\_\+id\}A\{numero\})
\item Piso inicial\+: 0 (planta baja)
\item Puertas cerradas
\item Sin tarea asignada
\item Estado parado y disponible
\end{DoxyItemize}
\end{DoxyEnumerate}

\begin{DoxyNote}{Note}
El número de ascensores debe estar entre 1 y MAX\+\_\+\+ELEVATORS\+\_\+\+PER\+\_\+\+GATEWAY 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
elevator\+\_\+group\+\_\+state\+\_\+t 

elevator\+\_\+status\+\_\+t 
\end{DoxySeeAlso}
\Hypertarget{elevator__state__manager_8c_a9f8c127c735277e87e71a52ba68d2e56}\label{elevator__state__manager_8c_a9f8c127c735277e87e71a52ba68d2e56} 
\index{elevator\_state\_manager.c@{elevator\_state\_manager.c}!movement\_direction\_to\_string@{movement\_direction\_to\_string}}
\index{movement\_direction\_to\_string@{movement\_direction\_to\_string}!elevator\_state\_manager.c@{elevator\_state\_manager.c}}
\doxysubsubsection{\texorpdfstring{movement\_direction\_to\_string()}{movement\_direction\_to\_string()}}
{\footnotesize\ttfamily const char \texorpdfstring{$\ast$}{*} movement\+\_\+direction\+\_\+to\+\_\+string (\begin{DoxyParamCaption}\item[{movement\+\_\+direction\+\_\+enum\+\_\+t}]{direction }\end{DoxyParamCaption})}



Convierte una dirección de movimiento a su representación en string. 


\begin{DoxyParams}{Parameters}
{\em direction} & Dirección de movimiento a convertir \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
String representando la dirección de movimiento
\end{DoxyReturn}
Esta función proporciona una representación legible de la dirección de movimiento del ascensor para logging y serialización JSON.

Direcciones soportadas\+:
\begin{DoxyItemize}
\item MOVING\+\_\+\+UP\+: "{}\+SUBIENDO"{}
\item MOVING\+\_\+\+DOWN\+: "{}\+BAJANDO"{}
\item STOPPED\+: "{}\+PARADO"{}
\item Otros\+: "{}\+DESCONOCIDO"{} 
\end{DoxyItemize}
