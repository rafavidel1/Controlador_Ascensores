\doxysection{include/servidor\+\_\+central/psk\+\_\+validator.h File Reference}
\label{psk__validator_8h}\index{include/servidor\_central/psk\_validator.h@{include/servidor\_central/psk\_validator.h}}


Validador de claves PSK para autenticación DTLS.  


\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \textbf{ psk\+\_\+validator\+\_\+init} (const char $\ast$keys\+\_\+file\+\_\+path)
\begin{DoxyCompactList}\small\item\em Inicializa el validador de claves PSK. \end{DoxyCompactList}\item 
int \textbf{ psk\+\_\+validator\+\_\+check\+\_\+key} (const char $\ast$key, size\+\_\+t key\+\_\+len)
\begin{DoxyCompactList}\small\item\em Valida si una clave PSK está en la lista de claves válidas. \end{DoxyCompactList}\item 
int \textbf{ psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity} (const char $\ast$identity, uint8\+\_\+t $\ast$key\+\_\+buffer, size\+\_\+t buffer\+\_\+size)
\begin{DoxyCompactList}\small\item\em Obtiene una clave PSK válida para una identidad específica. \end{DoxyCompactList}\item 
int \textbf{ psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+by\+\_\+index} (int index, uint8\+\_\+t $\ast$key\+\_\+buffer, size\+\_\+t buffer\+\_\+size)
\begin{DoxyCompactList}\small\item\em Obtiene una clave PSK por índice específico. \end{DoxyCompactList}\item 
void \textbf{ psk\+\_\+validator\+\_\+cleanup} (void)
\begin{DoxyCompactList}\small\item\em Libera los recursos del validador de claves PSK. \end{DoxyCompactList}\item 
int \textbf{ psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+count} (void)
\begin{DoxyCompactList}\small\item\em Obtiene el número total de claves PSK disponibles. \end{DoxyCompactList}\item 
int \textbf{ psk\+\_\+validator\+\_\+is\+\_\+initialized} (void)
\begin{DoxyCompactList}\small\item\em Verifica si el validador está inicializado. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Validador de claves PSK para autenticación DTLS. 

\begin{DoxyAuthor}{Author}
Sistema de Control de Ascensores 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
2.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2025
\end{DoxyDate}
Este archivo define las funciones para validar y gestionar claves PSK (Pre-\/\+Shared Keys) utilizadas en la autenticación DTLS-\/\+PSK del servidor central. El sistema utiliza un archivo de 15,000 claves únicas pre-\/generadas para garantizar la seguridad de las comunicaciones.

\begin{DoxySeeAlso}{See also}
\doxyref{dtls\+\_\+common\+\_\+config.\+h}{p.}{dtls__common__config_8h} 

\doxyref{server\+\_\+functions.\+h}{p.}{server__functions_8h} 
\end{DoxySeeAlso}


\doxysubsection{Function Documentation}
\label{psk__validator_8h_a27dde0ae78aff86e6e10e2fa34c04380} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_check\_key@{psk\_validator\_check\_key}}
\index{psk\_validator\_check\_key@{psk\_validator\_check\_key}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_check\_key()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+check\+\_\+key (\begin{DoxyParamCaption}\item[{const char $\ast$}]{key,  }\item[{size\+\_\+t}]{key\+\_\+len }\end{DoxyParamCaption})}



Valida si una clave PSK está en la lista de claves válidas. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em key} & Clave PSK a validar \\
\hline
\mbox{\texttt{ in}}  & {\em key\+\_\+len} & Longitud de la clave en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 si la clave es válida, 0 si no lo es
\end{DoxyReturn}
Esta función valida una clave PSK contra la lista de claves válidas\+:
\begin{DoxyItemize}
\item Busca la clave en la tabla hash de claves cargadas
\item Compara la clave proporcionada con las almacenadas
\item Retorna el resultado de la validación
\end{DoxyItemize}

\begin{DoxyNote}{Note}
La búsqueda es O(1) gracias al uso de tabla hash 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity}{p.}{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em key} & Clave PSK a validar \\
\hline
\mbox{\texttt{ in}}  & {\em key\+\_\+len} & Longitud de la clave en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 si la clave es válida, 0 si no lo es
\end{DoxyReturn}
Esta función valida una clave PSK contra la lista de claves válidas\+:
\begin{DoxyItemize}
\item Verifica que haya claves cargadas en memoria
\item Compara la clave proporcionada con cada clave almacenada
\item Utiliza comparación exacta de longitud y contenido
\item Retorna el resultado de la validación
\end{DoxyItemize}

\begin{DoxyNote}{Note}
La búsqueda es lineal O(n) donde n es el número de claves 

La función es thread-\/safe para lecturas concurrentes 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity}{p.}{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c} 
\end{DoxySeeAlso}
\label{psk__validator_8h_aec3fccc28ea8546380cd0c4efaacf603} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_cleanup@{psk\_validator\_cleanup}}
\index{psk\_validator\_cleanup@{psk\_validator\_cleanup}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_cleanup()}
{\footnotesize\ttfamily void psk\+\_\+validator\+\_\+cleanup (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Libera los recursos del validador de claves PSK. 

Esta función limpia todos los recursos asociados al validador\+:
\begin{DoxyItemize}
\item Cierra el archivo de claves si está abierto
\item Libera la memoria de la tabla hash de claves
\item Resetea el estado del validador
\item Libera cualquier buffer interno
\end{DoxyItemize}

\begin{DoxyNote}{Note}
Debe ser llamada al finalizar para evitar memory leaks 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+init}{p.}{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1}
\end{DoxySeeAlso}
Esta función limpia todos los recursos asociados al validador\+:
\begin{DoxyItemize}
\item Libera cada clave individual del array
\item Libera el array de punteros a claves
\item Resetea los contadores y punteros
\item Prepara el validador para una nueva inicialización
\end{DoxyItemize}

\begin{DoxyNote}{Note}
Debe ser llamada al finalizar para evitar memory leaks 

Es seguro llamar esta función múltiples veces 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+init}{p.}{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1} 
\end{DoxySeeAlso}
\label{psk__validator_8h_a51ef499b334e697efea613cdece4e89d} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_get\_key\_by\_index@{psk\_validator\_get\_key\_by\_index}}
\index{psk\_validator\_get\_key\_by\_index@{psk\_validator\_get\_key\_by\_index}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_get\_key\_by\_index()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+by\+\_\+index (\begin{DoxyParamCaption}\item[{int}]{index,  }\item[{uint8\+\_\+t $\ast$}]{key\+\_\+buffer,  }\item[{size\+\_\+t}]{buffer\+\_\+size }\end{DoxyParamCaption})}



Obtiene una clave PSK por índice específico. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em index} & Índice de la clave en el archivo (0-\/based) \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenará la clave \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene una clave PSK por su posición en el archivo\+:
\begin{DoxyItemize}
\item Lee la línea correspondiente al índice
\item Parsea la clave del formato identity\+:key
\item Copia la clave al buffer proporcionado
\item Valida que el índice esté dentro del rango válido
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El índice debe estar entre 0 y NUM\+\_\+\+PSK\+\_\+\+KEYS-\/1 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity}{p.}{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em index} & Índice de la clave en el archivo (0-\/based) \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenará la clave \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene una clave PSK por su posición en el array\+:
\begin{DoxyItemize}
\item Valida que el índice esté dentro del rango válido
\item Obtiene la clave del array de claves cargadas
\item Copia la clave al buffer proporcionado
\item Verifica que el buffer tenga espacio suficiente
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El índice debe estar entre 0 y count-\/1 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity}{p.}{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c} 
\end{DoxySeeAlso}
\label{psk__validator_8h_a97f71f7909e6e6b3f737e7ca9d88734d} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_get\_key\_count@{psk\_validator\_get\_key\_count}}
\index{psk\_validator\_get\_key\_count@{psk\_validator\_get\_key\_count}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_get\_key\_count()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+count (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Obtiene el número total de claves PSK disponibles. 

\begin{DoxyReturn}{Returns}
Número de claves PSK en el archivo
\end{DoxyReturn}
Esta función retorna el número total de claves PSK que han sido cargadas desde el archivo de claves.

\begin{DoxyNote}{Note}
Solo es válida después de llamar a psk\+\_\+validator\+\_\+init 
\end{DoxyNote}
\label{psk__validator_8h_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_get\_key\_for\_identity@{psk\_validator\_get\_key\_for\_identity}}
\index{psk\_validator\_get\_key\_for\_identity@{psk\_validator\_get\_key\_for\_identity}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_get\_key\_for\_identity()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity (\begin{DoxyParamCaption}\item[{const char $\ast$}]{identity,  }\item[{uint8\+\_\+t $\ast$}]{key\+\_\+buffer,  }\item[{size\+\_\+t}]{buffer\+\_\+size }\end{DoxyParamCaption})}



Obtiene una clave PSK válida para una identidad específica. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em identity} & Identidad del cliente \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenará la clave \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene la clave PSK correspondiente a una identidad\+:
\begin{DoxyItemize}
\item Busca la identidad en el archivo de claves
\item Copia la clave al buffer proporcionado
\item Verifica que el buffer tenga espacio suficiente
\item Retorna el resultado de la operación
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El buffer debe tener al menos MAX\+\_\+\+PSK\+\_\+\+LENGTH bytes 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+check\+\_\+key}{p.}{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380}
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em identity} & Identidad del cliente \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenará la clave \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene la clave PSK correspondiente a una identidad\+:
\begin{DoxyItemize}
\item Calcula un hash determinístico de la identidad
\item Usa el hash como índice para seleccionar una clave
\item Copia la clave seleccionada al buffer proporcionado
\item Verifica que el buffer tenga espacio suficiente
\end{DoxyItemize}

\begin{DoxyNote}{Note}
La selección es determinística\+: misma identidad = misma clave 

El algoritmo usa hash simple para distribución uniforme 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+check\+\_\+key}{p.}{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380} 
\end{DoxySeeAlso}
\label{psk__validator_8h_af84bfa633858d22629eeb419e53a30c1} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_init@{psk\_validator\_init}}
\index{psk\_validator\_init@{psk\_validator\_init}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_init()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+init (\begin{DoxyParamCaption}\item[{const char $\ast$}]{keys\+\_\+file\+\_\+path }\end{DoxyParamCaption})}



Inicializa el validador de claves PSK. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em keys\+\_\+file\+\_\+path} & Ruta al archivo de claves PSK\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se inicializó correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función inicializa el sistema de validación de claves PSK\+:
\begin{DoxyItemize}
\item Abre y lee el archivo de claves PSK
\item Carga las claves en memoria para acceso rápido
\item Valida el formato del archivo de claves
\item Configura el sistema de búsqueda de claves
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El archivo de claves debe contener pares identity\+:key 

Debe ser llamada antes de usar cualquier función de validación 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+cleanup}{p.}{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603}
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em keys\+\_\+file\+\_\+path} & Ruta al archivo de claves PSK\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se inicializó correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función inicializa el sistema de validación de claves PSK\+:
\begin{DoxyItemize}
\item Abre el archivo de claves PSK especificado
\item Cuenta el número de líneas en el archivo
\item Asigna memoria dinámica para almacenar las claves
\item Lee todas las claves del archivo y las almacena en memoria
\item Cierra el archivo después de la carga
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El archivo de claves debe contener una clave por línea 

La función maneja automáticamente la memoria dinámica 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxyref{psk\+\_\+validator\+\_\+cleanup}{p.}{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603} 
\end{DoxySeeAlso}
\label{psk__validator_8h_a500c8cc88b4792e167d32feb4a0404ef} 
\index{psk\_validator.h@{psk\_validator.h}!psk\_validator\_is\_initialized@{psk\_validator\_is\_initialized}}
\index{psk\_validator\_is\_initialized@{psk\_validator\_is\_initialized}!psk\_validator.h@{psk\_validator.h}}
\doxysubsubsection{psk\_validator\_is\_initialized()}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+is\+\_\+initialized (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Verifica si el validador está inicializado. 

\begin{DoxyReturn}{Returns}
1 si está inicializado, 0 en caso contrario
\end{DoxyReturn}
Esta función verifica si el validador de claves PSK ha sido inicializado correctamente y está listo para su uso.

\begin{DoxyNote}{Note}
Útil para verificar el estado antes de usar otras funciones 
\end{DoxyNote}
