\doxysection{src/psk\+\_\+validator.c File Reference}
\hypertarget{psk__validator_8c}{}\label{psk__validator_8c}\index{src/psk\_validator.c@{src/psk\_validator.c}}


Implementación del validador de credenciales para autenticación DTLS.  


{\ttfamily \#include "{}servidor\+\_\+central/psk\+\_\+validator.\+h"{}}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
Include dependency graph for psk\+\_\+validator.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{psk__validator_8c__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structpsk__valid__keys__t}{psk\+\_\+valid\+\_\+keys\+\_\+t}}
\begin{DoxyCompactList}\small\item\em Estructura para almacenar las credenciales válidas. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1}{psk\+\_\+validator\+\_\+init}} (const char \texorpdfstring{$\ast$}{*}keys\+\_\+file\+\_\+path)
\begin{DoxyCompactList}\small\item\em Inicializa el validador de credenciales. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380}{psk\+\_\+validator\+\_\+check\+\_\+key}} (const char \texorpdfstring{$\ast$}{*}key, size\+\_\+t key\+\_\+len)
\begin{DoxyCompactList}\small\item\em Valida si unas credenciales están en la lista de credenciales válidas. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity}} (const char \texorpdfstring{$\ast$}{*}identity, uint8\+\_\+t \texorpdfstring{$\ast$}{*}key\+\_\+buffer, size\+\_\+t buffer\+\_\+size)
\begin{DoxyCompactList}\small\item\em Obtiene credenciales válidas para una identidad específica. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{psk__validator_8c_a51ef499b334e697efea613cdece4e89d}{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+by\+\_\+index}} (int index, uint8\+\_\+t \texorpdfstring{$\ast$}{*}key\+\_\+buffer, size\+\_\+t buffer\+\_\+size)
\begin{DoxyCompactList}\small\item\em Obtiene credenciales por índice específico. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603}{psk\+\_\+validator\+\_\+cleanup}} (void)
\begin{DoxyCompactList}\small\item\em Libera los recursos del validador de credenciales. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{psk__validator_8c_a97f71f7909e6e6b3f737e7ca9d88734d}{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+count}} (void)
\begin{DoxyCompactList}\small\item\em Obtiene el número total de credenciales disponibles. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{psk__validator_8c_a500c8cc88b4792e167d32feb4a0404ef}{psk\+\_\+validator\+\_\+is\+\_\+initialized}} (void)
\begin{DoxyCompactList}\small\item\em Verifica si el validador está inicializado. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementación del validador de credenciales para autenticación DTLS. 

\begin{DoxyAuthor}{Author}
Sistema de Control de Ascensores 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
2.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2025
\end{DoxyDate}
Este archivo implementa el sistema de validación de credenciales utilizado en la autenticación DTLS del servidor central. El sistema carga credenciales desde un archivo de configuración y proporciona funciones para validar y obtener credenciales de forma determinística basada en la identidad del cliente.

\begin{DoxySeeAlso}{See also}
psk\+\_\+validator.\+h 

dtls\+\_\+common\+\_\+config.\+h 
\end{DoxySeeAlso}


\doxysubsection{Function Documentation}
\Hypertarget{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380}\label{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_check\_key@{psk\_validator\_check\_key}}
\index{psk\_validator\_check\_key@{psk\_validator\_check\_key}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_check\_key()}{psk\_validator\_check\_key()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+check\+\_\+key (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{key,  }\item[{size\+\_\+t}]{key\+\_\+len }\end{DoxyParamCaption})}



Valida si unas credenciales están en la lista de credenciales válidas. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em key} & Credenciales a validar \\
\hline
\mbox{\texttt{ in}}  & {\em key\+\_\+len} & Longitud de las credenciales en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 si las credenciales son válidas, 0 si no lo son
\end{DoxyReturn}
Esta función valida unas credenciales contra la lista de credenciales válidas\+:
\begin{DoxyItemize}
\item Verifica que haya credenciales cargadas en memoria
\item Compara las credenciales proporcionadas con cada credencial almacenada
\item Utiliza comparación exacta de longitud y contenido
\item Retorna el resultado de la validación
\end{DoxyItemize}

\begin{DoxyNote}{Note}
La búsqueda es lineal O(n) donde n es el número de credenciales 

La función es thread-\/safe para lecturas concurrentes 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity} 
\end{DoxySeeAlso}
\Hypertarget{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603}\label{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_cleanup@{psk\_validator\_cleanup}}
\index{psk\_validator\_cleanup@{psk\_validator\_cleanup}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_cleanup()}{psk\_validator\_cleanup()}}
{\footnotesize\ttfamily void psk\+\_\+validator\+\_\+cleanup (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Libera los recursos del validador de credenciales. 

Esta función limpia todos los recursos asociados al validador\+:
\begin{DoxyItemize}
\item Libera cada credencial individual del array
\item Libera el array de punteros a credenciales
\item Resetea los contadores y punteros
\item Prepara el validador para una nueva inicialización
\end{DoxyItemize}

\begin{DoxyNote}{Note}
Debe ser llamada al finalizar para evitar memory leaks 

Es seguro llamar esta función múltiples veces 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1}{psk\+\_\+validator\+\_\+init} 
\end{DoxySeeAlso}
\Hypertarget{psk__validator_8c_a51ef499b334e697efea613cdece4e89d}\label{psk__validator_8c_a51ef499b334e697efea613cdece4e89d} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_get\_key\_by\_index@{psk\_validator\_get\_key\_by\_index}}
\index{psk\_validator\_get\_key\_by\_index@{psk\_validator\_get\_key\_by\_index}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_get\_key\_by\_index()}{psk\_validator\_get\_key\_by\_index()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+by\+\_\+index (\begin{DoxyParamCaption}\item[{int}]{index,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{key\+\_\+buffer,  }\item[{size\+\_\+t}]{buffer\+\_\+size }\end{DoxyParamCaption})}



Obtiene credenciales por índice específico. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em index} & Índice de las credenciales en el archivo (0-\/based) \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenarán las credenciales \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene credenciales por su posición en el array\+:
\begin{DoxyItemize}
\item Valida que el índice esté dentro del rango válido
\item Obtiene las credenciales del array de credenciales cargadas
\item Copia las credenciales al buffer proporcionado
\item Verifica que el buffer tenga espacio suficiente
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El índice debe estar entre 0 y count-\/1 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}{psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity} 
\end{DoxySeeAlso}
\Hypertarget{psk__validator_8c_a97f71f7909e6e6b3f737e7ca9d88734d}\label{psk__validator_8c_a97f71f7909e6e6b3f737e7ca9d88734d} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_get\_key\_count@{psk\_validator\_get\_key\_count}}
\index{psk\_validator\_get\_key\_count@{psk\_validator\_get\_key\_count}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_get\_key\_count()}{psk\_validator\_get\_key\_count()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+count (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Obtiene el número total de credenciales disponibles. 

\begin{DoxyReturn}{Returns}
Número de credenciales en el archivo
\end{DoxyReturn}
Esta función retorna el número total de credenciales que han sido cargadas desde el archivo de configuración.

\begin{DoxyNote}{Note}
Solo es válida después de llamar a psk\+\_\+validator\+\_\+init 
\end{DoxyNote}
\Hypertarget{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c}\label{psk__validator_8c_a9cf6c3d9a1ca4ecafc27b4b5cf059d9c} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_get\_key\_for\_identity@{psk\_validator\_get\_key\_for\_identity}}
\index{psk\_validator\_get\_key\_for\_identity@{psk\_validator\_get\_key\_for\_identity}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_get\_key\_for\_identity()}{psk\_validator\_get\_key\_for\_identity()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+get\+\_\+key\+\_\+for\+\_\+identity (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{identity,  }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{key\+\_\+buffer,  }\item[{size\+\_\+t}]{buffer\+\_\+size }\end{DoxyParamCaption})}



Obtiene credenciales válidas para una identidad específica. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em identity} & Identidad del cliente \\
\hline
\mbox{\texttt{ out}}  & {\em key\+\_\+buffer} & Buffer donde se almacenarán las credenciales \\
\hline
\mbox{\texttt{ in}}  & {\em buffer\+\_\+size} & Tamaño del buffer en bytes\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se obtuvo correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función obtiene las credenciales correspondientes a una identidad\+:
\begin{DoxyItemize}
\item Calcula un hash determinístico de la identidad
\item Usa el hash como índice para seleccionar unas credenciales
\item Copia las credenciales seleccionadas al buffer proporcionado
\item Verifica que el buffer tenga espacio suficiente
\end{DoxyItemize}

\begin{DoxyNote}{Note}
La selección es determinística\+: misma identidad = mismas credenciales 

El algoritmo usa hash simple para distribución uniforme 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{psk__validator_8c_a27dde0ae78aff86e6e10e2fa34c04380}{psk\+\_\+validator\+\_\+check\+\_\+key} 
\end{DoxySeeAlso}
\Hypertarget{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1}\label{psk__validator_8c_af84bfa633858d22629eeb419e53a30c1} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_init@{psk\_validator\_init}}
\index{psk\_validator\_init@{psk\_validator\_init}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_init()}{psk\_validator\_init()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+init (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{keys\+\_\+file\+\_\+path }\end{DoxyParamCaption})}



Inicializa el validador de credenciales. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em keys\+\_\+file\+\_\+path} & Ruta al archivo de configuración de autenticación\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 si se inicializó correctamente, -\/1 en caso de error
\end{DoxyReturn}
Esta función inicializa el sistema de validación de credenciales\+:
\begin{DoxyItemize}
\item Abre el archivo de configuración especificado
\item Cuenta el número de líneas en el archivo
\item Asigna memoria dinámica para almacenar las credenciales
\item Lee todas las credenciales del archivo y las almacena en memoria
\item Cierra el archivo después de la carga
\end{DoxyItemize}

\begin{DoxyNote}{Note}
El archivo debe contener una credencial por línea 

La función maneja automáticamente la memoria dinámica 
\end{DoxyNote}
\begin{DoxySeeAlso}{See also}
\doxylink{psk__validator_8c_aec3fccc28ea8546380cd0c4efaacf603}{psk\+\_\+validator\+\_\+cleanup} 
\end{DoxySeeAlso}
\Hypertarget{psk__validator_8c_a500c8cc88b4792e167d32feb4a0404ef}\label{psk__validator_8c_a500c8cc88b4792e167d32feb4a0404ef} 
\index{psk\_validator.c@{psk\_validator.c}!psk\_validator\_is\_initialized@{psk\_validator\_is\_initialized}}
\index{psk\_validator\_is\_initialized@{psk\_validator\_is\_initialized}!psk\_validator.c@{psk\_validator.c}}
\doxysubsubsection{\texorpdfstring{psk\_validator\_is\_initialized()}{psk\_validator\_is\_initialized()}}
{\footnotesize\ttfamily int psk\+\_\+validator\+\_\+is\+\_\+initialized (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Verifica si el validador está inicializado. 

\begin{DoxyReturn}{Returns}
1 si está inicializado, 0 en caso contrario
\end{DoxyReturn}
Esta función verifica si el validador de credenciales ha sido inicializado correctamente y está listo para su uso.

\begin{DoxyNote}{Note}
Útil para verificar el estado antes de usar otras funciones 
\end{DoxyNote}
